(this["webpackJsonppostgraphile-fe"]=this["webpackJsonppostgraphile-fe"]||[]).push([[0],{105:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(63),l=n.n(o),i=n(37),c=n(34),u=n(17),s=n(14),m=n(42),d=n(82),v=n(81),p=n(16),f=n(64),b=n(67),g="".concat("todoapp","_jwt");function h(e){sessionStorage.setItem(g,e)}function E(){return sessionStorage.getItem(g)}var j=n(112),O=Object(s.a)(Object(s.a)({},j.a),{},{breakpoints:["30em","48em","62em","80em"],fonts:{heading:'"Avenir Next", sans-serif',body:"system-ui, sans-serif",mono:"Menlo, monospace"},colors:Object(s.a)(Object(s.a)({},j.a.colors),{},{primary:"purple"}),buttons:{variants:{primary:{maxWidth:"120px",color:"white",bg:"primary"}}},fontSizes:Object(s.a)(Object(s.a)({},j.a.fontSizes),{},{xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"4rem"})}),w=n(41),y=n(115),S=n(49),x=S.a.model("CurrentUser",{id:"",email:""}).actions((function(e){return{updateUser:function(t){var n=t.id,a=t.email;e.id=n||e.id,e.email=a||e.email},reset:function(){e.id="",e.email=""}}})).views((function(e){return{isLoggedIn:function(){return Boolean(e.id)}}}));var I=S.a.model("RootStore",{currentUser:x}).create({currentUser:x.create({})}),k=Object(a.createContext)(I),C=function(){return Object(a.useContext)(k)},U=k.Provider,P=n(40),$=n(28),W=n(29),L=n.n(W),z=n(21);function A(){var e=Object($.a)(["\n    mutation createUser($email: String!, $password: String!) {\n        createUser(input: { email: $email, password: $password }) {\n            success\n            message\n            user {\n                id\n            }\n        }\n    }\n"]);return A=function(){return e},e}function B(){var e=Object($.a)(["\n    mutation logout {\n        logout {\n            success\n        }\n    }\n"]);return B=function(){return e},e}function q(){var e=Object($.a)(["\n    mutation login($email: String!, $password: String!) {\n        login(input: { email: $email, password: $password }) {\n            success\n            message\n            user {\n                id\n            }\n            token\n        }\n    }\n"]);return q=function(){return e},e}function M(){var e=Object($.a)(["\n    query whoAmI {\n        whoAmI {\n            id\n        }\n    }\n"]);return M=function(){return e},e}function D(){var e=Object($.a)(["\n    mutation createPost($post: CreatePostInput!) {\n        createPost(input: $post) {\n            success\n            message\n            post {\n                ...post\n            }\n        }\n    }\n    ","\n"]);return D=function(){return e},e}function Q(){var e=Object($.a)(["\n    query userWithPosts($userId: ID!) {\n        user(id: $userId) {\n            ...userWithPosts\n        }\n    }\n    ","\n"]);return Q=function(){return e},e}function T(){var e=Object($.a)(["\n    query allPosts {\n        posts {\n            ...post\n        }\n    }\n    ","\n"]);return T=function(){return e},e}function G(){var e=Object($.a)(["\n    fragment userWithPosts on User {\n        email\n        posts {\n            title\n            body\n        }\n    }\n"]);return G=function(){return e},e}function N(){var e=Object($.a)(["\n    fragment post on Post {\n        id\n        title\n        body\n        author {\n            email\n        }\n    }\n"]);return N=function(){return e},e}var R=L()(N()),F=L()(G()),J=L()(T(),R);var H=L()(Q(),F);var _=L()(D(),R);var K=L()(M());function V(e){return z.d(K,e)}var X=L()(q());var Y=L()(B());var Z=L()(A());var ee=n(83),te=function(e){var t=e.loading,n=e.children;return t?r.a.createElement(ee.a,{thickness:"3px",speed:"1s",emptyColor:"gray.200",color:"blue.500",size:"xl"}):r.a.createElement("div",null,n)},ne=function(e){var t=e.redirect,n=e.location,a=e.mustBeLoggedOut,o=Object(P.a)(e,["redirect","location","mustBeLoggedOut"]),l=V({fetchPolicy:"no-cache"}),i=l.loading,u=l.data,s=null===u||void 0===u?void 0:u.whoAmI,m=a?s:!s;return r.a.createElement(te,{loading:i},m?r.a.createElement(c.a,{to:{pathname:t||"/login",state:{from:n}}}):r.a.createElement(c.b,o))},ae=n(59),re=n.n(ae),oe=n(71),le=n(10),ie=n(9),ce=n(38),ue=n(111),se=n(73),me=n(113),de=n(110),ve=n(114),pe=n(109),fe=function(e){return r.a.createElement(pe.a,Object(s.a)({isInline:!0,align:"center"},e))},be=function(e){var t=e.name,n=e.label,a=e.labelWidth,o=Object(P.a)(e,["name","label","labelWidth"]);return r.a.createElement(fe,{my:8},r.a.createElement(de.a,{width:a||120,htmlFor:t},n),r.a.createElement(ve.a,Object.assign({name:t,display:"inline-block"},o)))},ge=n(55),he=function(e){var t=e.children,n=e.onSubmit;return r.a.createElement("form",{onSubmit:n},r.a.createElement(ge.a,null,t))},Ee=function(e){var t=e.handleSubmit,n=e.errorMessage,o=Object(a.useState)({email:"",password:""}),l=Object(le.a)(o,2),i=l[0],c=l[1],u=function(e){var t=e.currentTarget,n=t.name,a=t.value;c(Object(s.a)(Object(s.a)({},i),{},Object(ce.a)({},n,a)))};return r.a.createElement(he,{onSubmit:function(e){e.preventDefault(),t(i)}},r.a.createElement(ue.a,{fontSize:"3xl"},"Welcome back!"),r.a.createElement(be,{name:"email",type:"email",autoComplete:"email",label:"Email:",value:i.email,placeholder:"example@bitmatica.com",onChange:u,display:"inline-block"}),r.a.createElement(be,{name:"password",type:"password",autoComplete:"password",label:"Password:",value:i.password,isRequired:!0,onChange:u}),r.a.createElement(se.a,{direction:"row",justifyContent:"flex-end"},r.a.createElement(me.a,Object.assign({},O.buttons.variants.primary,{type:"submit"}),"Login")),r.a.createElement(ue.a,{color:"red"},n))},je=function(){var e,t,n=z.c(X,t),r=C(),o=Object(le.a)(n,2)[1],l=o.called,i=o.loading,c=o.data,u=null===c||void 0===c||null===(e=c.login)||void 0===e?void 0:e.token;return Object(a.useEffect)((function(){if(l&&!i){if(!u)throw new Error("Wrong username/password.");h(u),r.currentUser.updateUser(null===c||void 0===c?void 0:c.login.user)}})),n};function Oe(){var e,t=C(),n=z.c(Y,e),r=Object(le.a)(n,2)[1],o=r.called,l=r.loading,i=r.data,c=Object(z.a)();return Object(a.useEffect)((function(){o&&!l&&(null===i||void 0===i?void 0:i.logout.success)&&(t.currentUser.reset(),h(""),c.writeQuery({query:K,data:{whoAmI:null}}))})),n}var we=function(e){var t=Oe(),n=Object(le.a)(t,2),a=n[0],o=n[1],l=o.called,i=o.loading,u=o.data;return l&&!i&&(null===u||void 0===u?void 0:u.logout.success)?r.a.createElement(c.a,{to:"login"}):r.a.createElement(me.a,Object.assign({},O.buttons.variants.primary,{variant:"outline",onClick:function(){a()}},e),e.children)},ye=n(76),Se=function(){var e=V({pollInterval:400}),t=e.loading,n=e.data;return r.a.createElement(te,{loading:t},r.a.createElement(se.a,{direction:"row",align:"center",height:16,color:"white",backgroundColor:"primary"},r.a.createElement(ye.a,{ml:8,name:"view",size:"24px"}),r.a.createElement(ue.a,{ml:8,fontSize:"4xl"},"Bitmatiblog"),(null===n||void 0===n?void 0:n.whoAmI)&&r.a.createElement(we,{ml:"auto",mr:4},"Logout")))},xe=function(e){var t=e.children;return r.a.createElement(se.a,{border:"1px solid black",alignContent:"center",minHeight:"100vh",direction:"column"},r.a.createElement(Se,null),r.a.createElement(ie.a,{maxWidth:["100%","100%",O.sizes["3xl"]],width:[null,null,"80%"],mx:[4,4,"0 auto"],pt:[4],bg:"blackAlpha.50",flexGrow:2},t))},Ie=function(){var e=je(),t=Object(le.a)(e,2),n=t[0],o=t[1].data,l=Object(a.useState)(""),i=Object(le.a)(l,2),u=i[0],s=i[1],m=!(null===o||void 0===o?void 0:o.login.success)&&(null===o||void 0===o?void 0:o.login.message);m&&m!==u&&s(m);var d=function(){var e=Object(oe.a)(re.a.mark((function e(t){return re.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({variables:t});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(null===o||void 0===o?void 0:o.login.success)?r.a.createElement(c.a,{to:"/"}):r.a.createElement(xe,null,r.a.createElement(ie.a,{pt:8},r.a.createElement(Ee,{handleSubmit:d,errorMessage:u})))},ke=function(e){var t=e.post;return r.a.createElement("div",null,r.a.createElement("div",null,t.id),r.a.createElement("div",null,t.title),r.a.createElement("div",null,t.body))},Ce=function(e){var t=e.posts;return(null===t||void 0===t?void 0:t.length)?r.a.createElement("div",null,t.map((function(e){return r.a.createElement(ke,{key:e.id,post:e})}))):r.a.createElement("div",null,"No posts!")},Ue=function(e){var t,n,a,o=e.userId,l=(a={variables:{userId:o}},z.d(H,a)),i=l.loading,c=l.data;return r.a.createElement(te,{loading:i},r.a.createElement("div",null,"User profile"),r.a.createElement("div",null,"Id: ",o),r.a.createElement("div",null,"Email: ",null===c||void 0===c||null===(t=c.user)||void 0===t?void 0:t.email),r.a.createElement("div",null,"Posts: ",r.a.createElement(Ce,{posts:(null===c||void 0===c||null===(n=c.user)||void 0===n?void 0:n.posts)||[]})))},Pe=n(77);function $e(){return e={update:function(e,t){var n,a,r=null===t||void 0===t||null===(n=t.data)||void 0===n||null===(a=n.createPost)||void 0===a?void 0:a.post,o=e.readQuery({query:J});e.writeQuery({query:J,data:Object(Pe.a)(o,(function(e){e.posts.push(r)}))})}},z.c(_,e);var e}var We=function(e){var t=e.authorId,n=$e(),o=Object(le.a)(n,1)[0],l=Object(a.useState)(""),i=Object(le.a)(l,2),c=i[0],u=i[1],s=Object(a.useState)(""),m=Object(le.a)(s,2),d=m[0],v=m[1],p={title:c,authorId:t,body:d};return r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),o({variables:{post:p}})}},"Create Post:",r.a.createElement("input",{value:c,onChange:function(e){return u(e.target.value)}}),r.a.createElement("input",{value:d,onChange:function(e){return v(e.target.value)}}),r.a.createElement("input",{value:"Submit",type:"submit"}))},Le=function(){var e,t=V(),n=t.loading,a=t.data,o=(null===a||void 0===a||null===(e=a.whoAmI)||void 0===e?void 0:e.id)||"";return r.a.createElement(xe,null,r.a.createElement(te,{loading:n},r.a.createElement(We,{authorId:o}),r.a.createElement(Ue,{userId:o})))},ze=function(e){var t=e.match;return r.a.createElement(xe,null,r.a.createElement(Ue,{userId:t.params.userId}))},Ae=function(e){var t=e.redirect,n=Object(P.a)(e,["redirect"]);return r.a.createElement(ne,Object.assign({redirect:t||"/",mustBeLoggedOut:!0},n))},Be=n(78),qe=n.n(Be),Me=n(79),De=n.n(Me),Qe=["email","password"],Te=function(e){var t=e.values,n=e.handleChange;return r.a.createElement("div",null,Object.keys(t).map((function(e){var a=Qe.includes(e)?e:"text";return r.a.createElement("label",{key:e},qe()(e),r.a.createElement("input",{type:a,name:e,onChange:n,value:De()(t,[e])}))})))},Ge=function(e){var t=e.inputs,n=e.errorMessage,a=e.handleSubmit,o=e.handleUpdate;return r.a.createElement("form",{onSubmit:function(e){e&&e.preventDefault(),a()}},"Register User Form",r.a.createElement(Te,{values:t,handleChange:o}),r.a.createElement("input",{type:"submit",value:"Submit"}),r.a.createElement("div",null,n))},Ne={email:"",password:""},Re=function(){var e,t=Object(a.useState)(Ne),n=Object(le.a)(t,2),o=n[0],l=n[1],i=z.c(Z,e),u=Object(le.a)(i,2),m=u[0],d=u[1].data,v=je(),p=Object(le.a)(v,2),f=p[0],b=p[1],g=b.called,h=b.loading,E=b.data;(null===d||void 0===d?void 0:d.createUser.success)&&!g&&f({variables:o});return!h&&(null===E||void 0===E?void 0:E.login.success)?r.a.createElement(c.a,{to:"/"}):r.a.createElement(xe,null,r.a.createElement(Ge,{inputs:o,errorMessage:null===d||void 0===d?void 0:d.createUser.message,handleSubmit:function(){m({variables:o})},handleUpdate:function(e){var t=e.currentTarget,n=t.name,a=t.value;l((function(e){return Object(s.a)(Object(s.a)({},e),{},Object(ce.a)({},n,a))}))}}))},Fe=function(e){e.match;return r.a.createElement(xe,null,r.a.createElement("a",{href:"/apps/gusto"},"Connect Gusto"))},Je=n(80),He=n.n(Je);function _e(){var e=Object(a.useState)(null),t=Object(le.a)(e,2),n=t[0],o=t[1],l=Object(a.useState)(!1),i=Object(le.a)(l,2),c=i[0],u=i[1];return Object(a.useEffect)((function(){He()("https://gusto.apps.bitmatica.com/oauth/gusto",{headers:{Authorization:"Bearer ".concat(E())}}).then((function(e){return e.json()})).then((function(e){u(!0),window.location=e.uri}),(function(e){u(!0),o(e)}))}),[]),n?r.a.createElement("div",null,"Error: ",n.message):c?r.a.createElement("div",null):r.a.createElement("div",null,"Loading...")}var Ke=function(){var e=Object(f.a)((function(e,t){var n=t.headers,a=E();return{headers:Object(s.a)(Object(s.a)({},n),a&&"null"!==a&&{authorization:"Bearer ".concat(a)})}})),t=Object(b.a)((function(e){var t=e.graphQLErrors,n=e.networkError;t&&t.map((function(e){var t=e.message,n=e.locations,a=e.path;return console.log("[GraphQL error]: Message: ".concat(t,", Location: ").concat(n,", Path: ").concat(a))})),n&&console.log("[Network error]: ".concat(n))})),n=Object(d.a)({uri:"https://gusto.apps.bitmatica.com/graphql"}),a=new v.a;return new m.a({cache:a,link:p.a.from([e,t,n]),connectToDevTools:!0})}();window.apolloClient=Ke;var Ve=function(){var e=C();return r.a.createElement(U,{value:e},r.a.createElement(w.a,{theme:O},r.a.createElement(y.a,null),r.a.createElement(i.a,null,r.a.createElement(u.a,{client:Ke},r.a.createElement(c.d,null,r.a.createElement(Ae,{path:"/login",component:Ie}),r.a.createElement(Ae,{path:"/register",component:Re}),r.a.createElement(ne,{path:"/user/:userId",component:ze}),r.a.createElement(ne,{path:"/oauth/connect",component:Fe}),r.a.createElement(ne,{path:"/apps/gusto",component:_e}),r.a.createElement(ne,{path:"*",component:Le}))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(Ve,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},84:function(e,t,n){e.exports=n(105)}},[[84,1,2]]]);
//# sourceMappingURL=main.1d0259af.chunk.js.map